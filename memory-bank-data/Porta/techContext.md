# Technical Context

## Porta v1.3.0 - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

#### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
1. **FastAPI —Å–µ—Ä–≤–µ—Ä** - –æ—Å–Ω–æ–≤–Ω–æ–π API —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 8111
2. **SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∞–≥–µ–Ω—Ç–æ–≤ –∏ –∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
3. **Middleware –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** - –ø—Ä–æ–≤–µ—Ä–∫–∞ X-PORTA-TOKEN –∑–∞–≥–æ–ª–æ–≤–∫–∞
4. **Ngrok –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ API
5. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
```sql
-- –¢–∞–±–ª–∏—Ü–∞ –∞–≥–µ–Ω—Ç–æ–≤
CREATE TABLE agents (
    id TEXT PRIMARY KEY,
    name TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_seen TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    total_operations INTEGER DEFAULT 0,
    status TEXT DEFAULT 'active'
);

-- –¢–∞–±–ª–∏—Ü–∞ –æ–ø–µ—Ä–∞—Ü–∏–π –∞–≥–µ–Ω—Ç–æ–≤
CREATE TABLE agent_operations (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    agent_id TEXT,
    operation_type TEXT,
    details TEXT,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    success BOOLEAN DEFAULT TRUE,
    FOREIGN KEY (agent_id) REFERENCES agents (id)
);
```

### üîß API Endpoints

#### –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
- `POST /run_bash` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ bash –∫–æ–º–∞–Ω–¥
- `POST /write_file` - —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- `POST /read_file` - —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- `POST /list_dir` - –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ø–∞–ø–æ–∫

#### –°–∏—Å—Ç–µ–º–Ω—ã–µ endpoints:
- `GET /meta` - —Å–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `GET /public_url` - –ø—É–±–ª–∏—á–Ω—ã–π URL —á–µ—Ä–µ–∑ ngrok

#### –ê–≥–µ–Ω—Ç–Ω—ã–µ endpoints:
- `POST /agent/status` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞–≥–µ–Ω—Ç–∞
- `POST /agent/list` - —Å–ø–∏—Å–æ–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤
- `POST /agent/history` - –∏—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –∞–≥–µ–Ω—Ç–∞
- `POST /agent/pipeline` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥

### üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

#### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:
- **X-PORTA-TOKEN** –∑–∞–≥–æ–ª–æ–≤–æ–∫ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –¢–æ–∫–µ–Ω –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `PORTA_TOKEN`
- Middleware –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω –¥–ª—è –≤—Å–µ—Ö endpoints

#### –í–∞–ª–∏–¥–∞—Ü–∏—è:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—É—Ç–µ–π (–∑–∞–ø—Ä–µ—Ç `..`, `/etc`, `/dev`, `/proc`)
- –í–∞–ª–∏–¥–∞—Ü–∏—è agent_id (–Ω–µ –ø—É—Å—Ç–æ–π)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫ –¥–æ—Å—Ç—É–ø–∞

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π:
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞–≥–µ–Ω—Ç–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ SQLite
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
- Timestamp –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏
- –°—Ç–∞—Ç—É—Å —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏

#### –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
- –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞ (uptime)
- PID –ø—Ä–æ—Ü–µ—Å—Å–∞
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π

### üöÄ –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ v1.3.0

#### 1. –•—Ä–∞–Ω–∏–ª–∏—â–µ –∞–≥–µ–Ω—Ç–æ–≤
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** - –∞–≥–µ–Ω—Ç—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
- **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏** - –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

#### 2. –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è** - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∫–∞–∂–¥–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è** - –ø–æ —Ç–∏–ø—É –æ–ø–µ—Ä–∞—Ü–∏–∏, –≤—Ä–µ–º–µ–Ω–∏
- **–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –æ—à–∏–±–∫–∏

#### 3. Pipeline –∫–æ–º–∞–Ω–¥
- **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** - –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ –ø–æ—Ä—è–¥–∫—É
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ
- **–î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** - stdout, stderr, returncode –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã
- **–¢–∞–π–º–∞—É—Ç—ã** - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è –∫–æ–º–∞–Ω–¥

#### 4. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞–º–∏
- **–°–ø–∏—Å–æ–∫ –∞–≥–µ–Ω—Ç–æ–≤** - —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- **–°—Ç–∞—Ç—É—Å –∞–≥–µ–Ω—Ç–æ–≤** - –∞–∫—Ç–∏–≤–Ω—ã–µ/–Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ
- **–ú–µ—Ç—Ä–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏** - –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è, –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∞–≥–µ–Ω—Ç–∞

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** - –∞–≥–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
2. **–û–ø–µ—Ä–∞—Ü–∏–∏** - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏** - –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
4. **–ò—Å—Ç–æ—Ä–∏—è** - –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ API

### üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

#### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- **SQLite** - –ª–µ–≥–∫–æ–≤–µ—Å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫
- **–ò–Ω–¥–µ–∫—Å—ã** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö
- **–ü—É–ª—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π** - –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫

#### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:
- **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ endpoints
- **–†–∞—Å—à–∏—Ä—è–µ–º–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- **API-first –ø–æ–¥—Ö–æ–¥** - –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ REST API

### üéØ –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

1. **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π, –Ω–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π API
2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
4. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ endpoints
5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –∫–æ–¥–æ–º